// AGGRESSIVE TAB FIXES - Use ::ng-deep to pierce ViewEncapsulation
::ng-deep {
  // Force narrow tab headers - 1/9 width each
  .mat-mdc-tab-group .mat-mdc-tab-header .mat-mdc-tab-label-container .mat-mdc-tab-list .mat-mdc-tab,
  .mat-mdc-tab-header .mat-mdc-tab,
  .mat-mdc-tab {
    width: calc(100vw / 9) !important;
    max-width: calc(100vw / 9) !important;
    min-width: calc(100vw / 9) !important;
    flex: 0 0 calc(100vw / 9) !important;
    flex-grow: 0 !important;
    flex-shrink: 0 !important;
    flex-basis: calc(100vw / 9) !important;
  }
  
  // Force indicator to TOP position
  .mat-mdc-tab .mdc-tab-indicator,
  .mat-mdc-tab .mdc-tab-indicator__content,
  .mat-mdc-tab .mdc-tab-indicator__content--underline,
  .mdc-tab-indicator,
  .mdc-tab-indicator__content,
  .mdc-tab-indicator__content--underline {
    top: 0 !important;
    bottom: auto !important;
    height: 3px !important;
    transform: translateY(0) !important;
  }
  
  // Fallback for older Angular Material
  .mat-ink-bar {
    top: 0 !important;
    bottom: auto !important;
    height: 3px !important;
  }
  
  // Ensure tab labels are centered in narrow tabs
  .mat-mdc-tab-label,
  .mat-tab-label {
    width: 100% !important;
    text-align: center !important;
    justify-content: center !important;
    padding: 0 4px !important;
    font-size: 0.875rem !important;
  }
}

// Fix for Angular Material v19 form field sizing issues
.additional-selection {
  opacity: 0.75;
  font-size: 0.75em;
}

.mat-form-field-no-margin {
  margin-top: 0px;
}

// Angular Material v19 compatibility fixes
.mat-mdc-form-field {
  width: 100%;
  
  // Ensure proper sizing for all form fields
  &.mat-form-field-appearance-fill {
    width: 100%;
  }
  
  // Fix for input field width
  .mat-mdc-text-field-wrapper {
    width: 100%;
  }
  
  // Fix for select field width
  .mat-mdc-select {
    width: 100%;
  }
  
  // Fix for textarea width
  .mat-mdc-input-element {
    width: 100%;
    box-sizing: border-box;
  }
}

// Ensure Bootstrap grid columns work properly with Angular Material
.app-flex-row {
  display: flex;
  flex-wrap: wrap;
  margin: 0 -15px;
  
  [class*="col-"] {
    padding: 0 15px;
    
    // Ensure form fields take full width of their container
    .mat-mdc-form-field {
      width: 100%;
      min-width: 0; // Prevent flex items from overflowing
    }
  }
}

// Fix for date picker fields that might be too narrow
.col-md-2 {
  .mat-mdc-form-field {
    min-width: 150px; // Ensure date fields have minimum width
  }
}

// Fix for button toggle groups
.mat-button-toggle-group {
  display: flex;
  flex-wrap: wrap;
  
  .mat-button-toggle {
    flex: 1;
    min-width: auto;
  }
}

// Fix for select dropdown width
.mat-mdc-select-panel {
  min-width: 100%;
}

// Fix for modal content to prevent overflow
.app-modal-content {
  overflow-x: hidden;
  width: 100%;
  
  // Tab headers narrow, but content full width
  .mat-mdc-tab-group {
    width: 100%;
    
    // Fix for tab header - only the clickable tab area is narrow
    .mat-mdc-tab-header {
      width: 100%;
      
      .mat-mdc-tab-header-pagination {
        display: none !important; // Hide pagination arrows if any
      }
      
      .mat-mdc-tab-label-container {
        width: 100%; // Container takes full width
        
        .mat-mdc-tab-list {
          width: 100%; // List takes full width
          display: flex;
          justify-content: flex-start; // Align tabs to left
          
          .mat-mdc-tab {
            // Force narrow width - 1/9 of viewport width
            flex: none !important;
            width: calc(100vw / 9) !important; // Each tab header is 1/9 of viewport width
            max-width: calc(100vw / 9) !important;
            min-width: calc(100vw / 9) !important;
            position: relative;
            
            .mat-mdc-tab-label {
              width: 100% !important;
              justify-content: center;
              padding: 0 4px; // Minimal padding for narrow tab headers
              min-width: 0 !important;
              font-size: 0.875rem; // Smaller font for narrow headers
              text-align: center;
            }
            
            // Move the active tab indicator to TOP instead of bottom
            .mdc-tab-indicator {
              top: 0 !important; // Move to top
              bottom: auto !important; // Remove from bottom
              height: 3px !important; // Keep indicator height
            }
            
            .mat-mdc-tab-ripple {
              width: calc(100vw / 9) !important;
            }
          }
        }
      }
    }
    
    // Content area remains full width
    .mat-mdc-tab-body-wrapper {
      width: 100%;
    }
    
    .mat-mdc-tab-body-content {
      width: 100%;
      overflow-x: hidden;
    }
  }
}

// Fix for form field labels and hints
.mat-mdc-form-field-subscript-wrapper {
  width: 100%;
}

// Responsive fixes for smaller screens
@media (max-width: 768px) {
  .app-flex-row {
    [class*="col-md-"] {
      flex: 0 0 100%;
      max-width: 100%;
      margin-bottom: 16px;
    }
  }
  
  // Stack button toggles vertically on small screens
  .mat-button-toggle-group {
    flex-direction: column;
    
    .mat-button-toggle {
      width: 100%;
    }
  }
}

// Fix for dialog actions
.app-modal-actions {
  width: 100%;
  
  table {
    width: 100%;
    table-layout: fixed;
    
    td {
      vertical-align: middle;
    }
  }
}

// Additional fixes for Angular Material v19 specific issues
.mat-mdc-form-field-flex {
  width: 100%;
}

.mat-mdc-form-field-infix {
  width: 100%;
  min-width: 0;
}

// Fix for checkbox in select dropdown
.mat-mdc-option .mat-mdc-checkbox {
  margin-right: 8px;
}

// Ensure proper spacing between form rows
.app-flex-row + .app-flex-row {
  margin-top: 16px;
}

// Fix for mat-hint alignment
.mat-mdc-form-field-hint-wrapper {
  width: 100%;
}

// Fix for error messages
.mat-mdc-form-field-error-wrapper {
  width: 100%;
}

// Additional tab fixes for Angular Material v19 - narrow tab headers only
.mat-mdc-tab-group {
  // Ensure proper structure: full-width container, narrow tab buttons
  .mat-mdc-tab-header {
    .mat-mdc-tab-label-container {
      // Container takes full width to hold narrow tabs
      flex: 1;
      width: 100%;
      
      .mat-mdc-tab-list {
        // List takes full width but tabs inside are narrow
        justify-content: flex-start;
        width: 100%;
        
        .mat-mdc-tab {
          // Force narrow width with !important - 1/9 of viewport
          flex: none !important;
          width: calc(100vw / 9) !important;
          max-width: calc(100vw / 9) !important;
          min-width: calc(100vw / 9) !important;
          position: relative;
          
          // Center the tab text within narrow tab header
          .mat-mdc-tab-label {
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px; // Minimal padding for narrow tab headers
            font-size: 0.875rem;
            width: 100% !important;
          }
          
          // Move active indicator to top
          .mdc-tab-indicator {
            top: 0 !important;
            bottom: auto !important;
            height: 3px !important;
          }
          
          .mat-mdc-tab-ripple {
            width: calc(100vw / 9) !important;
          }
        }
      }
    }
  }
}

// Fallback for older Angular Material versions - narrow tab headers only
.mat-tab-group {
  width: 100%;
  
  .mat-tab-header {
    width: 100%;
    
    .mat-tab-label-container {
      width: 100%; // Container full width
      flex: 1;
      
      .mat-tab-list {
        width: 100%; // List full width
        display: flex;
        justify-content: flex-start;
        
        .mat-tab-label {
          // Force narrow width for older versions
          flex: none !important;
          width: calc(100vw / 9) !important; // 1/9 of viewport width
          max-width: calc(100vw / 9) !important;
          min-width: calc(100vw / 9) !important;
          justify-content: center;
          padding: 0 4px;
          font-size: 0.875rem;
          position: relative;
        }
        
        // For older Angular Material - move indicator to top
        .mat-ink-bar {
          top: 0 !important;
          bottom: auto !important;
          height: 3px !important;
        }
      }
    }
  }
}

// Force full width for dialog content
mat-dialog-content {
  width: 100%;
  max-width: 100%;
  
  .app-flex-row {
    width: 100%;
    
    .col-md-12 {
      width: 100%;
      padding: 0 15px;
    }
  }
}

// Additional overrides to force narrow tab width
.mat-mdc-tab-group .mat-mdc-tab-header .mat-mdc-tab-label-container .mat-mdc-tab-list .mat-mdc-tab {
  width: calc(100vw / 9) !important;
  max-width: calc(100vw / 9) !important;
  min-width: calc(100vw / 9) !important;
  flex: none !important;
  flex-grow: 0 !important;
  flex-shrink: 0 !important;
  flex-basis: calc(100vw / 9) !important;
}

// Force tab indicator to top position
.mat-mdc-tab .mdc-tab-indicator,
.mat-mdc-tab .mdc-tab-indicator__content,
.mat-mdc-tab .mdc-tab-indicator__content--underline {
  top: 0 !important;
  bottom: auto !important;
  height: 3px !important;
}

// Override any default tab width behavior
.mat-mdc-tab-header .mat-mdc-tab {
  width: calc(100vw / 9) !important;
  max-width: calc(100vw / 9) !important;
  min-width: calc(100vw / 9) !important;
}

// Ensure tab content area stays full width
.mat-mdc-tab-body-wrapper,
.mat-mdc-tab-body,
.mat-mdc-tab-body-content {
  width: 100% !important;
  max-width: 100% !important;
}

// FINAL AGGRESSIVE OVERRIDES - These should be at the end to have highest priority
::ng-deep .mat-mdc-tab-group {
  .mat-mdc-tab-header {
    .mat-mdc-tab-label-container {
      .mat-mdc-tab-list {
        .mat-mdc-tab {
          // FORCE narrow width with maximum specificity
          width: calc(100vw / 9) !important;
          max-width: calc(100vw / 9) !important;
          min-width: calc(100vw / 9) !important;
          flex: 0 0 calc(100vw / 9) !important;
          
          // FORCE indicator to top
          .mdc-tab-indicator {
            top: 0 !important;
            bottom: auto !important;
            height: 3px !important;
            position: absolute !important;
          }
          
          .mdc-tab-indicator__content {
            top: 0 !important;
            bottom: auto !important;
            height: 3px !important;
          }
        }
      }
    }
  }
}

// Alternative approach using attribute selectors for maximum override
::ng-deep [role="tab"] {
  width: calc(100vw / 9) !important;
  max-width: calc(100vw / 9) !important;
  min-width: calc(100vw / 9) !important;
  flex: 0 0 calc(100vw / 9) !important;
}

// Force indicator positioning with attribute selectors
::ng-deep [role="tab"] .mdc-tab-indicator,
::ng-deep [role="tab"] .mdc-tab-indicator__content {
  top: 0 !important;
  bottom: auto !important;
  height: 3px !important;
}